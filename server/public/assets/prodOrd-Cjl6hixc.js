import{p as F,r as b,q as S,h as K,i as u,l as n,b as a,w as p,n as s,v as c,u as i,t as O,C as z,A as L,s as H,o as G}from"./index-CJ3q1JqJ.js";import{_ as X}from"./AdminLayout-C24uwuk1.js";import{_ as Y}from"./common-BC0Yipj8.js";import{_ as M}from"./ComponentCardButton.vue_vue_type_script_setup_true_lang-BzeZFBPb.js";import{s as J,a as m}from"./index-BK6avQhT.js";import{C as I}from"./component-CQdj2KLS.js";import{k as U}from"./ko-uxAFNFCj.js";import{P as Q}from"./ProductSelectmodal-CRdXtgnA.js";import{a as W}from"./index-ngrFHoWO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal.vue_vue_type_script_setup_true_lang-By9v9QUL.js";const ee={class:"space-y-5 sm:space-y-6"},te={class:"flex justify-end"},ae=["disabled"],re={class:"flex gap-4 mb-1.5"},oe={class:"flex-1"},le={class:"flex-1"},de={class:"flex-1"},ne={class:"flex items-center gap-4"},se={class:"relative",style:{"min-width":"260px"}},ie={class:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300"},ue={class:"relative w-45"},me={class:"relative w-45"},pe={class:"remark-box"},ce={class:"space-y-5 sm:space-y-6 mt-2"},be={class:"flex justify-end"},ye={class:"card h-70"},ke=["onUpdate:modelValue"],ge=["onUpdate:modelValue","onBlur","onKeydown"],_e=["onUpdate:modelValue"],E="dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",P="dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:shadow-focus-ring focus:outline-hidden focus:ring-0 disabled:border-gray-100 disabled:bg-gray-50 disabled:placeholder:text-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 dark:disabled:border-gray-800 dark:disabled:bg-white/[0.03] dark:disabled:placeholder:text-white/15",k="block text-sm font-medium text-gray-700 dark:text-gray-400 mb-2",f="dark:bg-dark-900 h-8 w-full rounded-lg border border-gray-300 bg-transparent pl-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",Ee=F({__name:"prodOrd",setup(he){const g=(d=>{const t=[...d].sort((e,r)=>{const C=e.desiredRank??e.make_priority??Number.MAX_SAFE_INTEGER,V=r.desiredRank??r.make_priority??Number.MAX_SAFE_INTEGER;return C!==V?C-V:(e.make_priority??0)!==(r.make_priority??0)?(e.make_priority??0)-(r.make_priority??0):e.no!==r.no?e.no.localeCompare(r.no):e.prod_code.localeCompare(r.prod_code)});return t.forEach((e,r)=>{e.make_priority=r+1,delete e.desiredRank}),t}),v=((d,t)=>{const e=Math.max(1,Math.floor(Number(t)||1));d.desiredRank=e;const r=g(l.value);l.value.splice(0,l.value.length,...r)}),_=b([]),l=b([]),o=b({make_code:"",make_name:"",emp_name:"",make_start_date:"",make_end_date:"",remake:""}),j=()=>new Date().toISOString().slice(0,10),D=S(()=>({dateFormat:"Y-m-d",altInput:!1,wrap:!0,minDate:j(),maxDate:o.value.make_end_date,locale:U.Korean})),q=S(()=>({dateFormat:"Y-m-d",altInput:!1,wrap:!0,minDate:o.value.make_start_date,locale:U.Korean})),h=b(!1),N=()=>{h.value=!0},$=()=>{h.value=!1},B=d=>{d.forEach(e=>{const r=`${Date.now()}_${e.prod_code}`;l.value.push({no:r,prod_code:e.prod_code,prod_name:e.prod_name,prod_spec:e.prod_spec,prod_unit:e.prod_unit,make_qty:e.make_qty||1,make_priority:e.make_priority??l.value.length+1,remark:e.remark||"",pld_no:e.pld_no||""})});const t=g(l.value);l.value.splice(0,l.value.length,...t),h.value=!1},T=d=>{l.value=l.value.filter(e=>!d.includes(e)),d.length=0;const t=g(l.value);l.value.splice(0,l.value.length,...t)},A={make_code:"",make_name:"",emp_name:"",make_start_date:"",make_end_date:"",remake:""},x=()=>{o.value={...A},l.value=[],_.value=[]},R=()=>g(l.value).map((d,t)=>({no:String(t+1),prod_code:d.prod_code,mk_num:Number(d.make_qty||1),mk_priority:d.make_priority,remark:d.remark||null,pld_no:d.pld_no||null})),y=b(!1),w=async()=>{var e;if(y.value)return;if(!o.value.make_name){alert("생산지시명을 입력하세요.");return}if(!o.value.make_start_date||!o.value.make_end_date){alert("시작일과 종료일을 입력하세요.");return}if(l.value.length===0){alert("제품을 한 개 이상 선택하세요.");return}if(l.value.some(r=>r.make_priority==null)){alert("우선순위를 입력하지 않은 제품이 있습니다.");return}const d={mk_name:o.value.make_name,mk_bgnde:o.value.make_start_date,mk_ende:o.value.make_end_date,writing_date:new Date().toISOString().slice(0,10),remark:o.value.remake??null,emp_id:"EMP-20250616-0002"},t=R();try{y.value=!0;const r=await W.post("/api/prodOrd",{header:d,details:t},{headers:{"Content-Type":"application/json"}});alert(`등록 완료: 지시번호 ${((e=r.data)==null?void 0:e.mk_ord_no)??""}`),x()}catch(r){console.error(r),alert("등록 실패")}finally{y.value=!1}},Z=b("생산 지시 관리");return(d,t)=>(G(),K(X,null,{default:u(()=>[n(Y,{pageTitle:Z.value},null,8,["pageTitle"]),a("form",{action:"",id:"submitMakeInfo",onSubmit:H(w,["prevent"])},[a("div",ee,[n(M,{title:"기본사항",class:s(["shadow-md rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"])},{"header-right":u(()=>[a("div",te,[t[8]||(t[8]=a("button",{type:"button",class:"btn-white btn-common",style:{width:"auto"}},"계획서 불러오기",-1)),t[9]||(t[9]=a("button",{type:"button",class:"btn-white btn-common"},"지시 목록",-1)),a("button",{type:"button",class:"btn-white btn-common",onClick:x},"초기화"),a("button",{type:"button",class:"btn-color btn-common",onClick:w,disabled:y.value},O(y.value?"등록 중":"등록/수정"),9,ae),t[10]||(t[10]=a("button",{type:"button",class:"btn-white btn-common"},"삭제",-1))])]),"body-content":u(()=>[a("div",re,[a("div",oe,[a("label",{class:s(k)}," 생산지시코드 "),p(a("input",{type:"text",disabled:"",class:s(P),"onUpdate:modelValue":t[0]||(t[0]=e=>o.value.make_code=e),required:""},null,512),[[c,o.value.make_code]])]),a("div",le,[a("label",{class:s(k)}," 생산지시명 "),p(a("input",{type:"text",class:s(E),"onUpdate:modelValue":t[1]||(t[1]=e=>o.value.make_name=e)},null,512),[[c,o.value.make_name]])]),a("div",de,[a("label",{class:s(k)}," 지시담당자 "),p(a("input",{type:"text",disabled:"",class:s(P),"onUpdate:modelValue":t[2]||(t[2]=e=>o.value.emp_name=e),required:""},null,512),[[c,o.value.emp_name]])])]),a("div",ne,[a("div",se,[a("label",{class:s(k)}," 생산일자 "),a("div",ie,[a("div",ue,[n(i(I),{modelValue:o.value.make_start_date,"onUpdate:modelValue":t[3]||(t[3]=e=>o.value.make_start_date=e),config:D.value,class:"dark:bg-dark-900 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pl-4 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"시작일"},null,8,["modelValue","config"]),t[11]||(t[11]=a("span",{class:"absolute text-gray-500 -translate-y-1/2 pointer-events-none right-3 top-1/2 dark:text-gray-400"},[a("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.66659 1.5415C7.0808 1.5415 7.41658 1.87729 7.41658 2.2915V2.99984H12.5833V2.2915C12.5833 1.87729 12.919 1.5415 13.3333 1.5415C13.7475 1.5415 14.0833 1.87729 14.0833 2.2915V2.99984L15.4166 2.99984C16.5212 2.99984 17.4166 3.89527 17.4166 4.99984V7.49984V15.8332C17.4166 16.9377 16.5212 17.8332 15.4166 17.8332H4.58325C3.47868 17.8332 2.58325 16.9377 2.58325 15.8332V7.49984V4.99984C2.58325 3.89527 3.47868 2.99984 4.58325 2.99984L5.91659 2.99984V2.2915C5.91659 1.87729 6.25237 1.5415 6.66659 1.5415ZM6.66659 4.49984H4.58325C4.30711 4.49984 4.08325 4.7237 4.08325 4.99984V6.74984H15.9166V4.99984C15.9166 4.7237 15.6927 4.49984 15.4166 4.49984H13.3333H6.66659ZM15.9166 8.24984H4.08325V15.8332C4.08325 16.1093 4.30711 16.3332 4.58325 16.3332H15.4166C15.6927 16.3332 15.9166 16.1093 15.9166 15.8332V8.24984Z",fill:""})])],-1))]),t[13]||(t[13]=a("span",null,"ㅡ",-1)),a("div",me,[n(i(I),{modelValue:o.value.make_end_date,"onUpdate:modelValue":t[4]||(t[4]=e=>o.value.make_end_date=e),config:q.value,class:"dark:bg-dark-900 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pl-4 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"종료일"},null,8,["modelValue","config"]),t[12]||(t[12]=a("span",{class:"absolute text-gray-500 -translate-y-1/2 pointer-events-none right-3 top-1/2 dark:text-gray-400"},[a("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.66659 1.5415C7.0808 1.5415 7.41658 1.87729 7.41658 2.2915V2.99984H12.5833V2.2915C12.5833 1.87729 12.919 1.5415 13.3333 1.5415C13.7475 1.5415 14.0833 1.87729 14.0833 2.2915V2.99984L15.4166 2.99984C16.5212 2.99984 17.4166 3.89527 17.4166 4.99984V7.49984V15.8332C17.4166 16.9377 16.5212 17.8332 15.4166 17.8332H4.58325C3.47868 17.8332 2.58325 16.9377 2.58325 15.8332V7.49984V4.99984C2.58325 3.89527 3.47868 2.99984 4.58325 2.99984L5.91659 2.99984V2.2915C5.91659 1.87729 6.25237 1.5415 6.66659 1.5415ZM6.66659 4.49984H4.58325C4.30711 4.49984 4.08325 4.7237 4.08325 4.99984V6.74984H15.9166V4.99984C15.9166 4.7237 15.6927 4.49984 15.4166 4.49984H13.3333H6.66659ZM15.9166 8.24984H4.08325V15.8332C4.08325 16.1093 4.30711 16.3332 4.58325 16.3332H15.4166C15.6927 16.3332 15.9166 16.1093 15.9166 15.8332V8.24984Z",fill:""})])],-1))])])]),a("div",pe,[a("label",{class:s(k)}," 비고 "),p(a("input",{type:"text",class:s(E),"onUpdate:modelValue":t[5]||(t[5]=e=>o.value.remake=e)},null,512),[[c,o.value.remake]])])])]),_:1}),a("div",ce,[n(M,{title:"지시할 제품",class:s(["shadow-md rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"])},{"header-right":u(()=>[a("div",be,[a("button",{type:"button",class:"btn-color btn-common",onFocus:N},"제품추가",32),a("button",{type:"button",class:"btn-white btn-common",onClick:t[6]||(t[6]=()=>T(_.value))},"제품삭제"),n(Q,{disabledProdCodes:l.value.map(e=>e.prod_code),onSelectedProductValue:B,visible:h.value,onClose:$},null,8,["disabledProdCodes","visible"])])]),"body-content":u(()=>[a("div",ye,[n(i(J),{value:l.value,selection:_.value,"onUpdate:selection":t[7]||(t[7]=e=>_.value=e),"data-key":"no",tableStyle:"max-width: 100%;",class:"fixed-data",showGridlines:"",scrollable:"",scrollHeight:"280px",editMode:"cell",size:"small",rows:10},{empty:u(()=>[...t[14]||(t[14]=[a("div",{class:"text-center"},"제품을 추가해주세요",-1)])]),default:u(()=>[n(i(m),{selectionMode:"multiple",headerStyle:"width: 1%"}),n(i(m),{field:"prod_code",header:"제품코드",pt:{columnHeaderContent:"justify-center"},headerStyle:"width: 10%"}),n(i(m),{field:"prod_name",header:"제품명",pt:{columnHeaderContent:"justify-center"},headerStyle:"width: 15%"}),n(i(m),{field:"prod_spec",header:"규격",pt:{columnHeaderContent:"justify-center"},style:{"text-align":"right"},headerStyle:"width: 5%"}),n(i(m),{field:"prod_unit",header:"단위",pt:{columnHeaderContent:"justify-center"},style:{"text-align":"left"},headerStyle:"width: 5%"}),n(i(m),{field:"make_qty",header:"생산수량",pt:{columnHeaderContent:"justify-center"},style:{"text-align":"right"},headerStyle:"width: 7%"},{body:u(({data:e})=>[p(a("input",{"onUpdate:modelValue":r=>e.make_qty=r,type:"number",min:"1",class:s(f),style:{textAlign:"right"},placeholder:"생산수량"},null,8,ke),[[c,e.make_qty]])]),_:1}),n(i(m),{field:"make_priority",header:"우선순위",pt:{columnHeaderContent:"justify-center"},style:{"text-align":"right"},headerStyle:"width: 7%"},{body:u(({data:e})=>[p(a("input",{"onUpdate:modelValue":r=>e.make_priority=r,type:"number",min:1,class:s(f),style:L([{textAlign:"right"},{height:"2rem"}]),placeholder:"우선순위",onBlur:r=>v(e,e.make_priority),onKeydown:z(H(r=>v(e,e.make_priority),["prevent"]),["enter"])},null,40,ge),[[c,e.make_priority,void 0,{number:!0}]])]),_:1}),n(i(m),{field:"remark",header:"비고",pt:{columnHeaderContent:"justify-center"},style:{"text-align":"left"},headerStyle:"width: 24%"},{body:u(({data:e})=>[p(a("input",{"onUpdate:modelValue":r=>e.remark=r,type:"text",class:s(f),style:{height:"2rem"},placeholder:"내용을 입력해주세요."},null,8,_e),[[c,e.remark]])]),_:1})]),_:1},8,["value","selection"])])]),_:1})])])],32)]),_:1}))}});export{Ee as default};
