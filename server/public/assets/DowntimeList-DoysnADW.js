import{p as J,r,L as O,k as Z,B as Q,h as W,i as n,l as a,b as i,w,n as u,v as E,D as X,c as M,g as Y,t as m,F as ee,j as y,J as ae,u as s,E as te,G as se,o as S}from"./index-CJ3q1JqJ.js";import{a as v}from"./index-ngrFHoWO.js";import{_ as ie}from"./AdminLayout-C24uwuk1.js";import{_ as oe}from"./common-BC0Yipj8.js";import{_ as V}from"./ComponentCardOrder.vue_vue_type_script_setup_true_lang-BMJk9k7N.js";import{s as le,a as j,_ as ne}from"./index-Wzzk-T8C.js";import{s as T,a as l}from"./index-BK6avQhT.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"space-y-5 sm:space-y-6 mt-2"},re={class:"flex gap-4"},ue={class:"w-1/4"},ce={class:"w-1/4"},pe={class:"w-1/4"},me=["value"],ye={class:"hidden"},fe={class:"flex items-center gap-2"},we={class:"space-y-5 sm:space-y-6 mt-2"},ve={class:"space-y-5 sm:space-y-6 mt-2"},ge={class:"h-78"},N="dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-950 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",g="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400",Ne=J({__name:"DowntimeList",setup(he){const D=te(),U=se(),B=r("설비 기준정보 관리"),F=e=>({equipCode:e.equipCode??e.equip_code??"",equipName:e.equipName??e.equip_name??"",equipType:e.equipType??e.equip_type??"",equipTypeName:e.equipTypeName??e.equip_type_name??"",manager:e.manager??null,equipStatus:e.equipStatus??e.equip_status??"",equipStatusName:e.equipStatusName??e.equip_status_name??"",inspCycle:e.inspCycle??e.insp_cycle??null,installDate:e.installDate??e.install_date??null,modelName:e.modelName??e.model_name??null,equipImage:e.equipImage??e.equip_image??null,mfgDt:e.mfgDt??e.mfg_dt??null,maker:e.maker??null}),I=()=>({equipCode:"",equipName:"",equipType:"",equipStatus:"j1"}),L=()=>{if(!c.value){alert("설비를 선택하세요.");return}D.push({name:"DownTimeManage",query:{mode:"register",equipCode:c.value.equipCode}})},$=e=>{e&&D.push({name:"DownTimeManage",query:{mode:"detail",downtimeCode:e.downtimeCode??e.downtime_code}})},d=r(I()),h=O([]),c=r(null),q=r(0),_=r([]),b=r([]),x=async()=>{try{const{data:e}=await v.get("/api/equipment",{params:d.value});h.value=(Array.isArray(e)?e:[]).map(F)}catch(e){console.error(e),h.value=[]}},R=r([]),z=async()=>{try{const e=await v.get("/api/equipments");R.value=e.data}catch(e){console.error(e)}},C=async()=>{try{const{data:e}=await v.get("/api/downtime",{params:{status:"running"}});_.value=Array.isArray(e)?e:[]}catch(e){console.error("진행중 조회 실패:",e),_.value=[]}},k=async()=>{try{const{data:e}=await v.get("/api/downtime",{params:{status:"history"}});b.value=Array.isArray(e)?e:[]}catch(e){console.error("이력 조회 실패:",e),b.value=[]}},A=async()=>{await Promise.all([C(),k(),x()])};function f(e,o={}){if(!e)return"";const t=new Date(e),p=new Intl.DateTimeFormat("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",...o.weekday?{weekday:"short"}:{},hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"Asia/Seoul"}).format(t);return o.weekday&&/[월화수목금토일]/.test(p)?p.replace(/\.\s/g,".").replace(/\s([월화수목금토일])\s/," ($1) ").replace(/\.$/,"").replace(/(\d{4}\.\d{2}\.\d{2})/,"$1"):p.replace(/\.\s/g,".").replace(/\.$/,"").replace(/(\d{4}\.\d{2}\.\d{2})\./,"$1 ")}const G=()=>Object.assign(d.value,I()),H=e=>{c.value=e.data},K=e=>{c.value=e.value},P=async e=>{q.value=e.index,e.index===0?await C():await k()};return Z(async()=>{await A(),await z(),await x(),await C(),await k()}),Q(()=>U.query.refresh,async e=>{e&&await A()},{immediate:!1}),(e,o)=>(S(),W(ie,null,{default:n(()=>[a(oe,{pageTitle:B.value},null,8,["pageTitle"]),i("div",de,[a(V,{title:"조회"},{"header-right":n(()=>[i("div",{class:"flex justify-end gap-2"},[i("button",{onClick:G,class:"btn-common btn-color"},"초기화"),i("button",{onClick:x,class:"btn-common btn-white"},"조회")])]),"body-content":n(()=>[i("div",re,[i("div",ue,[i("label",{class:u(g)},"설비코드"),w(i("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>d.value.equipCode=t),type:"text",class:u(N)},null,512),[[E,d.value.equipCode]])]),i("div",ce,[i("label",{class:u(g)},"설비명"),w(i("input",{"onUpdate:modelValue":o[1]||(o[1]=t=>d.value.equipName=t),type:"text",class:u(N)},null,512),[[E,d.value.equipName]])]),i("div",pe,[i("label",{class:u(g)},"설비유형"),w(i("select",{"onUpdate:modelValue":o[2]||(o[2]=t=>d.value.equipType=t),class:u(N)},[o[8]||(o[8]=i("option",{value:""},"설비유형 선택",-1)),(S(!0),M(ee,null,Y(R.value,(t,p)=>(S(),M("option",{key:p,value:t.code},m(t.name),9,me))),128))],512),[[X,d.value.equipType]])]),i("div",ye,[i("div",{class:u(g)},"설비상태"),i("label",fe,[w(i("input",{"onUpdate:modelValue":o[3]||(o[3]=t=>d.value.equipStatus=t),type:"radio",name:"equip-using",value:"j1"},null,512),[[ae,d.value.equipStatus]]),o[9]||(o[9]=y(" 가동중 ",-1))])])])]),_:1})]),i("div",we,[a(V,{title:"설비목록"},{"header-right":n(()=>[i("div",{class:"flex justify-end"},[i("button",{class:"btn-common btn-color",onClick:L},"비가동")])]),"body-content":n(()=>[a(s(T),{value:h.value,showGridlines:"",selection:c.value,"onUpdate:selection":o[4]||(o[4]=t=>c.value=t),dataKey:"equipCode",scrollable:"",scrollHeight:"150px",class:"text-sm",rows:20,size:"small",onRowClick:H,onSelectionChange:K},{default:n(()=>[a(s(l),{selectionMode:"single",headerStyle:"width: 2.5rem"}),a(s(l),{field:"equipCode",header:"설비코드"}),a(s(l),{field:"equipName",header:"설비명"}),a(s(l),{field:"equipTypeName",header:"설비유형",sortable:""}),a(s(l),{field:"manager",header:"담당자",sortable:""}),a(s(l),{field:"equipStatusName",header:"설비상태",sortable:""}),a(s(l),{field:"inspCycle",header:"점검주기",sortable:"",style:{width:"110px","text-align":"center"}})]),_:1},8,["value","selection"])]),_:1})]),i("div",ve,[a(ne,{title:""},{"body-content":n(()=>[i("div",ge,[a(s(le),{activeIndex:q.value,"onUpdate:activeIndex":o[7]||(o[7]=t=>q.value=t),onTabChange:P,pt:{navContainer:{class:"pr-40"}}},{default:n(()=>[a(s(j),{header:"진행중"},{default:n(()=>[a(s(T),{value:_.value,showGridlines:"",dataKey:"downtimeId",scrollable:"",scrollHeight:"220px",class:"text-sm",rows:20,size:"small",onRowClick:o[5]||(o[5]=({data:t})=>$(t))},{default:n(()=>[a(s(l),{field:"equipCode",header:"설비코드"}),a(s(l),{field:"equipName",header:"설비명"}),a(s(l),{field:"downtimeType",header:"비가동유형"}),a(s(l),{field:"workerId",header:"담당자"}),a(s(l),{field:"downtimeStart",header:"비가동시작일시"},{body:n(({data:t})=>[y(m(f(t.downtimeStart)),1)]),_:1}),a(s(l),{field:"downtimeEnd",header:"비가동종료일시"},{body:n(({data:t})=>[y(m(t.downtimeEnd?f(t.downtimeEnd):"—"),1)]),_:1}),a(s(l),{field:"progressStatus",header:"진행상태"})]),_:1},8,["value"])]),_:1}),a(s(j),{header:"비가동 이력"},{default:n(()=>[a(s(T),{value:b.value,showGridlines:"",dataKey:"downtimeId",scrollable:"",scrollHeight:"220px",class:"text-sm",rows:20,size:"small",onRowClick:o[6]||(o[6]=({data:t})=>$(t))},{default:n(()=>[a(s(l),{field:"equipCode",header:"설비코드"}),a(s(l),{field:"equipName",header:"설비명"}),a(s(l),{field:"downtimeType",header:"비가동유형"}),a(s(l),{field:"workerId",header:"담당자"}),a(s(l),{field:"downtimeStart",header:"비가동시작일시"},{body:n(({data:t})=>[y(m(f(t.downtimeStart)),1)]),_:1}),a(s(l),{field:"downtimeEnd",header:"비가동종료일시"},{body:n(({data:t})=>[y(m(f(t.downtimeEnd)),1)]),_:1}),a(s(l),{field:"progressStatus",header:"진행상태"})]),_:1},8,["value"])]),_:1})]),_:1},8,["activeIndex"])])]),_:1})])]),_:1}))}});export{Ne as default};
