import{r as b,I as L,k as S,h as N,i as s,l as r,b as o,w as h,n as f,v as D,C as M,D as T,u as n,j as c,t as p,o as $}from"./index-CJ3q1JqJ.js";import{_ as R}from"./AdminLayout-C24uwuk1.js";import{_ as x}from"./ComponentCardButton.vue_vue_type_script_setup_true_lang-BzeZFBPb.js";import{_ as z}from"./common-BC0Yipj8.js";import{s as k,a as l}from"./index-BK6avQhT.js";import{u as B}from"./useDates-sS5pNIz9.js";import{a as w}from"./index-ngrFHoWO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const V={class:"space-y-5 sm:space-y-3"},F={class:"flex items-end gap-5 flex-wrap"},U={class:"w-72"},K={class:"w-72"},O={class:"relative z-20 bg-transparent"},E="dark:bg-dark-900 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-950 focus:outline-hidden focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",v="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400",G="dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-950 focus:outline-hidden focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",ee={__name:"MatList",setup(Y){const C=b("자재 재고 조회"),i=L({name:"",type:""}),_=b([]),m=b([]),y=async()=>{var a;try{const e={};(a=i.name)!=null&&a.trim()&&(e.mat_name=i.name.trim()),i.type&&(e.mat_item_code=i.type);const{data:t}=await w.get("/api/mat/page",{params:e});_.value=(t||[]).map(d=>({...d,lots:[],_lotsLoaded:!1})),m.value=[]}catch(e){console.error("[mat/page] fetch error:",e),_.value=[],m.value=[]}},j=async a=>{const{data:e}=await w.get("/api/lot/matList",{params:{mat_code:a}});return(e||[]).map(t=>({mat_lot:t.mat_lot,prod_date:t.prod_date,exp_date:t.exp_date,stock_qty:Number(t.stock_qty||0),receipt_qty:Number(t.receipt_qty||0),release_qty:Number(t.release_qty||0)}))},H=async({data:a})=>{if(!(!a||a._lotsLoaded))try{const e=await j(a.mat_code);a.lots=e,a._lotsLoaded=!0}catch(e){console.error("[lot/matList] fetch error:",e),a.lots=[],a._lotsLoaded=!0}},q=()=>{i.name="",i.type="",y()},u=a=>a==null?"":Number(a).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),g=a=>{if(!a)return null;try{return B.dateFormat(a,"yyyy-MM-dd")}catch{const e=new Date(a);if(isNaN(e))return null;const t=String(e.getMonth()+1).padStart(2,"0"),d=String(e.getDate()).padStart(2,"0");return`${e.getFullYear()}-${t}-${d}`}};return S(y),(a,e)=>($(),N(R,null,{default:s(()=>[r(z,{pageTitle:C.value},null,8,["pageTitle"]),o("div",V,[r(x,{title:"자재 검색"},{"header-right":s(()=>[o("div",{class:"flex justify-end space-x-2 mb-1"},[o("button",{type:"button",class:"btn-white btn-common",onClick:q},"초기화"),o("button",{type:"button",class:"btn-color btn-common",onClick:y},"조회")])]),"body-content":s(()=>[o("div",F,[o("div",U,[o("label",{class:f(v)},"자재명"),h(o("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>i.name=t),type:"text",class:f(G),placeholder:"자재명을 입력",onKeyup:M(y,["enter"])},null,544),[[D,i.name]])]),o("div",K,[o("label",{class:f(v)},"자재유형"),o("div",O,[h(o("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>i.type=t),class:f(E)},[...e[3]||(e[3]=[o("option",{value:""},"전체",-1),o("option",{value:"a1"},"주자재",-1),o("option",{value:"a2"},"부자재",-1)])],512),[[T,i.type]]),e[4]||(e[4]=o("span",{class:"absolute z-30 text-gray-500 -translate-y-1/2 pointer-events-none right-4 top-1/2 dark:text-gray-400"},[o("svg",{class:"stroke-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none"},[o("path",{d:"M4.79175 7.396L10.0001 12.6043L15.2084 7.396",stroke:"","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})])],-1))])])])]),_:1}),r(x,{title:"자재 재고 목록",style:{height:"561px"}},{"body-content":s(()=>[r(n(k),{expandedRows:m.value,"onUpdate:expandedRows":e[2]||(e[2]=t=>m.value=t),value:_.value,dataKey:"mat_code",onRowExpand:H,scrollable:"",scrollHeight:"431px",size:"small",showGridlines:"",tableStyle:{minWidth:"1200px"}},{expansion:s(({data:t})=>[r(n(k),{value:t.lots,size:"small",showGridlines:"",tableStyle:"min-width: 800px"},{empty:s(()=>[...e[5]||(e[5]=[o("div",{class:"text-center"},"추가된 LOT자재가 없습니다.",-1)])]),default:s(()=>[r(n(l),{field:"mat_lot",header:"자재LOT",pt:{columnHeaderContent:"justify-center"}}),r(n(l),{field:"prod_date",header:"제조일자",sortable:"",pt:{columnHeaderContent:"justify-center"},style:{"text-align":"center"}},{body:s(({data:d})=>[c(p(g(d.prod_date)),1)]),_:1}),r(n(l),{field:"exp_date",header:"유통기한",sortable:"",pt:{columnHeaderContent:"justify-center"},style:{"text-align":"center"}},{body:s(({data:d})=>[c(p(g(d.exp_date)),1)]),_:1}),r(n(l),{field:"release_qty",header:"출고수량",sortable:"",pt:{columnHeaderContent:"justify-center"},style:{"text-align":"right"}},{body:s(({data:d})=>[c(p(u(d.release_qty)),1)]),_:1}),r(n(l),{field:"receipt_qty",header:"입고수량",sortable:"",pt:{columnHeaderContent:"justify-center"},style:{"text-align":"right"}},{body:s(({data:d})=>[c(p(u(d.receipt_qty)),1)]),_:1}),r(n(l),{field:"stock_qty",header:"LOT재고",sortable:"",pt:{columnHeaderContent:"justify-center"},style:{"text-align":"right"}},{body:s(({data:d})=>[c(p(u(d.stock_qty)),1)]),_:1})]),_:1},8,["value"])]),default:s(()=>[r(n(l),{expander:"",style:{width:"50px"}}),r(n(l),{field:"mat_code",header:"자재코드",pt:{columnHeaderContent:"justify-center"}}),r(n(l),{field:"mat_name",header:"자재명",style:{width:"260px"},pt:{columnHeaderContent:"justify-center"}}),r(n(l),{field:"mat_spec",header:"규격",pt:{columnHeaderContent:"justify-center"}}),r(n(l),{field:"mat_unit",header:"단위",pt:{columnHeaderContent:"justify-center"}}),r(n(l),{field:"comncode_dtnm",header:"자재유형",sortable:"",pt:{columnHeaderContent:"justify-center"}}),r(n(l),{field:"mat_info",header:"자재정보",pt:{columnHeaderContent:"justify-center"}}),r(n(l),{field:"stock_qty",header:"재고",sortable:"",style:{"text-align":"right"},pt:{columnHeaderContent:"justify-center"}},{body:s(({data:t})=>[c(p(u(t.stock_qty)),1)]),_:1}),r(n(l),{field:"safe_stock",header:"안전재고",sortable:"",style:{"text-align":"right"},pt:{columnHeaderContent:"justify-center"}},{body:s(({data:t})=>[c(p(u(t.safe_stock)),1)]),_:1})]),_:1},8,["expandedRows","value"])]),_:1})])]),_:1}))}};export{ee as default};
