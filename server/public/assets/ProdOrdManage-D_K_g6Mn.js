import{p as K,r as s,q as S,k as L,h as $,i as d,l as a,b as t,n as u,u as r,s as z,w as G,v as O,t as x,E as W,o as F}from"./index-CJ3q1JqJ.js";import{_ as Q}from"./AdminLayout-C24uwuk1.js";import{_ as Y}from"./common-BC0Yipj8.js";import{_ as g}from"./ComponentCardOrder.vue_vue_type_script_setup_true_lang-BMJk9k7N.js";import{s as k,a as n}from"./index-BK6avQhT.js";import{a as C}from"./index-ngrFHoWO.js";import{C as M}from"./component-CQdj2KLS.js";import{k as j}from"./ko-uxAFNFCj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"space-y-5 sm:space-y-1 mt-2"},X={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},ee={class:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300"},te={class:"relative w-45"},ae={class:"relative w-45"},re={class:"space-y-5 sm:space-y-6 mt-2"},le={class:"flex items-center"},oe=["disabled"],ne={ref:"tableWrapper",class:"order-table-wrapper h-63"},de=["onUpdate:modelValue","max","onInput"],se={style:{"text-align":"right"}},ie={class:"flex gap-2 mt-2 width-full"},ce={ref:"tableWrapper",class:"order-table-wrapper h-47"},ue={class:"text-center"},pe={ref:"tableWrapper",class:"order-table-wrapper h-47"},I="dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",H="block text-sm font-medium text-gray-700 dark:text-gray-400 mb-2",me="dark:bg-dark-900 h-8 w-full rounded-lg border border-gray-300 bg-transparent pl-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",Ce=K({__name:"ProdOrdManage",setup(ye){const P=W(),c=s({prod_name:"",proc_name:"",make_order_start_date:"",make_order_end_date:""}),V=s([]),h=s([]),q=s([]),i=s(null),p=s(null),f=s(null),R=S(()=>({dateFormat:"Y-m-d",altInput:!1,wrap:!0,maxDate:c.value.make_order_end_date,locale:j.Korean})),N=S(()=>({dateFormat:"Y-m-d",altInput:!1,wrap:!0,minDate:c.value.make_order_start_date,locale:j.Korean})),_=s({selected:null}),E=l=>{const e=l.data;(!_.value.selected||_.value.selected.mk_ord_no!==e.mk_ord_no)&&U(),_.value={..._.value,selected:e},i.value=e,B(e.proc_name)},U=()=>{p.value=null,h.value=[]},b=s(null),B=async l=>{try{v.value=!0,b.value=null;const e=await C.get("/api/prodOrdManage/equipments",{params:{procName:l}});h.value=Array.isArray(e.data)?e.data:[]}catch(e){console.error(e),h.value=[],b.value="설비를 불러오지 못했습니다."}finally{v.value=!1}};L(async()=>{const l=await C.get("/api/prodOrdManage");V.value=l.data.makeRows??[],q.value=l.data.empRows??[]});const v=s(!1),m=s(!1),D=()=>{if(!i.value)return alert("지시 목록에서 제품(행)을 선택하세요."),!1;const l=i.value.inpt_qty;return!l||l<=0?(alert("투입수량을 0보다 크게 작성하세요."),!1):p.value?f.value?!0:(alert("작업자를 선택하세요."),!1):(alert("설비를 선택하세요."),!1)},T=async()=>{if(m.value||!D())return;const l=i.value,e=p.value,o=f.value,y={mkd_no:l.mkd_no,prod_code:l.prod_code,inpt_qty:l.inpt_qty,equip_code:e.equip_code,emp_id:o.emp_id,proc_id:l.proc_id,mk_ord_no:l.mk_ord_no};console.log("Process Start Payload:",y);try{m.value=!0;const w=await C.post("/api/startProcess",y);console.log("API Response (Process Started):",w),P.push({path:"/processControl",query:{emp_id:o.emp_id,equip_code:e.equip_code,mkd_no:l.mkd_no}})}catch(w){console.error("공정 시작 API 오류:",w),alert("공정 제어 시작 요청 실패. 서버 응답을 확인하세요."),m.value=!1}},Z=l=>{const e=Number(l.mk_num||0),o=Number(l.inpt_qty||0);l.inpt_qty=Math.min(e,Math.max(0,o)),i.value&&i.value.mk_ord_no===l.mk_ord_no&&(i.value.inpt_qty=l.inpt_qty)},A=s("공정 실적 관리");return(l,e)=>(F(),$(Q,null,{default:d(()=>[a(Y,{pageTitle:A.value},null,8,["pageTitle"]),t("div",J,[a(g,{title:"지시제품검색"},{"header-right":d(()=>[...e[6]||(e[6]=[t("div",{class:""},[t("button",{type:"button",class:"btn-white btn-common"},"초기화"),t("button",{type:"button",class:"btn-color btn-common"},"조회")],-1)])]),"body-content":d(()=>[t("div",X,[t("div",null,[t("label",{class:u(H)}," 제품명 "),t("input",{type:"text",class:u(I),placeholder:"제품 이름을 입력해주세요",required:""})]),t("div",null,[t("label",{class:u(H)}," 공정명 "),t("input",{type:"text",class:u(I),placeholder:"공정을 입력해주세요",required:""})]),t("div",null,[t("label",{class:u(H)}," 지시날짜 "),t("div",ee,[t("div",te,[a(r(M),{modelValue:c.value.make_order_start_date,"onUpdate:modelValue":e[0]||(e[0]=o=>c.value.make_order_start_date=o),config:R.value,class:"dark:bg-dark-900 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pl-4 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"범위 시작",type:"date"},null,8,["modelValue","config"]),e[7]||(e[7]=t("span",{class:"absolute text-gray-500 -translate-y-1/2 pointer-events-none right-3 top-1/2 dark:text-gray-400"},[t("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.66659 1.5415C7.0808 1.5415 7.41658 1.87729 7.41658 2.2915V2.99984H12.5833V2.2915C12.5833 1.87729 12.919 1.5415 13.3333 1.5415C13.7475 1.5415 14.0833 1.87729 14.0833 2.2915V2.99984L15.4166 2.99984C16.5212 2.99984 17.4166 3.89527 17.4166 4.99984V7.49984V15.8332C17.4166 16.9377 16.5212 17.8332 15.4166 17.8332H4.58325C3.47868 17.8332 2.58325 16.9377 2.58325 15.8332V7.49984V4.99984C2.58325 3.89527 3.47868 2.99984 4.58325 2.99984L5.91659 2.99984V2.2915C5.91659 1.87729 6.25237 1.5415 6.66659 1.5415ZM6.66659 4.49984H4.58325C4.30711 4.49984 4.08325 4.7237 4.08325 4.99984V6.74984H15.9166V4.99984C15.9166 4.7237 15.6927 4.49984 15.4166 4.49984H13.3333H6.66659ZM15.9166 8.24984H4.08325V15.8332C4.08325 16.1093 4.30711 16.3332 4.58325 16.3332H15.4166C15.6927 16.3332 15.9166 16.1093 15.9166 15.8332V8.24984Z",fill:""})])],-1))]),e[9]||(e[9]=t("span",null,"ㅡ",-1)),t("div",ae,[a(r(M),{modelValue:c.value.make_order_end_date,"onUpdate:modelValue":e[1]||(e[1]=o=>c.value.make_order_end_date=o),config:N.value,class:"dark:bg-dark-900 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pl-4 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"범위 끝",type:"date"},null,8,["modelValue","config"]),e[8]||(e[8]=t("span",{class:"absolute text-gray-500 -translate-y-1/2 pointer-events-none right-3 top-1/2 dark:text-gray-400"},[t("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.66659 1.5415C7.0808 1.5415 7.41658 1.87729 7.41658 2.2915V2.99984H12.5833V2.2915C12.5833 1.87729 12.919 1.5415 13.3333 1.5415C13.7475 1.5415 14.0833 1.87729 14.0833 2.2915V2.99984L15.4166 2.99984C16.5212 2.99984 17.4166 3.89527 17.4166 4.99984V7.49984V15.8332C17.4166 16.9377 16.5212 17.8332 15.4166 17.8332H4.58325C3.47868 17.8332 2.58325 16.9377 2.58325 15.8332V7.49984V4.99984C2.58325 3.89527 3.47868 2.99984 4.58325 2.99984L5.91659 2.99984V2.2915C5.91659 1.87729 6.25237 1.5415 6.66659 1.5415ZM6.66659 4.49984H4.58325C4.30711 4.49984 4.08325 4.7237 4.08325 4.99984V6.74984H15.9166V4.99984C15.9166 4.7237 15.6927 4.49984 15.4166 4.49984H13.3333H6.66659ZM15.9166 8.24984H4.08325V15.8332C4.08325 16.1093 4.30711 16.3332 4.58325 16.3332H15.4166C15.6927 16.3332 15.9166 16.1093 15.9166 15.8332V8.24984Z",fill:""})])],-1))])])])])]),_:1}),t("form",{onSubmit:e[5]||(e[5]=z(()=>{},["prevent"])),action:""},[t("div",re,[a(g,{title:"작업지시목록"},{"header-right":d(()=>[t("div",le,[t("button",{type:"button",class:"btn-color btn-common",onClick:T,disabled:m.value},x(m.value?"이동 중":"공정 제어"),9,oe)])]),"body-content":d(()=>[t("div",ne,[a(r(k),{dataKey:"no",tableStyle:"max-width: 100%;",class:"fixed-data dense-table",showGridlines:"",scrollable:"",scrollHeight:"250px",editMode:"cell",size:"small",value:V.value,selectionMode:"single",onRowSelect:E,selection:i.value,"onUpdate:selection":e[2]||(e[2]=o=>i.value=o)},{empty:d(()=>[...e[10]||(e[10]=[t("div",{class:"text-center"},"지시건이 없습니다",-1)])]),default:d(()=>[a(r(n),{selectionMode:"single",headerStyle:"width: 1%",field:"no",pt:{columnHeaderContent:"justify-center"}}),a(r(n),{field:"mk_ord_no",header:"작업지시코드",pt:{columnHeaderContent:"justify-center"},headerStyle:"width: 10%"}),a(r(n),{field:"writing_date",header:"지시일자",pt:{columnHeaderContent:"justify-center"},style:{"text-align":"center"},headerStyle:"width: 7%"}),a(r(n),{field:"mk_name",header:"작업지시명",pt:{columnHeaderContent:"justify-center"},headerStyle:"width: 10%"}),a(r(n),{field:"prod_code",header:"제품코드",pt:{columnHeaderContent:"justify-center"},headerStyle:"width: 10%"}),a(r(n),{field:"prod_name",header:"제품명",pt:{columnHeaderContent:"justify-center"},headerStyle:"width: 15%"}),a(r(n),{field:"prod_spec",header:"규격",style:{"text-align":"right"},pt:{columnHeaderContent:"justify-center"},headerStyle:"width: 5%"}),a(r(n),{field:"comncode_dtnm",header:"단위",style:{"text-align":"right"},pt:{columnHeaderContent:"justify-center"},headerStyle:"width: 5%"}),a(r(n),{field:"inpt_qty",header:"투입수량",pt:{columnHeaderContent:"justify-center"},style:{"text-align":"right"},headerStyle:"width: 7%"},{body:d(({data:o})=>[G(t("input",{"onUpdate:modelValue":y=>o.inpt_qty=y,type:"number",min:0,max:Number(o.mk_num||0),class:u(me),style:{"text-align":"right",height:"2rem"},onInput:y=>Z(o),placeholder:"투입"},null,40,de),[[O,o.inpt_qty,void 0,{number:!0}]])]),_:1}),a(r(n),{field:"remaining_qty",header:"잔여수량",pt:{columnHeaderContent:"justify-center"},style:{"text-align":"right"},headerStyle:"width: 5%"},{body:d(({data:o})=>[t("div",se,x(Math.max(0,Number(o.mk_num||0)-Number(o.inpt_qty||0))),1)]),_:1}),a(r(n),{field:"seq_no",header:"공정순서",style:{"text-align":"right"},pt:{columnHeaderContent:"justify-center"},class:"dense-table",headerStyle:"width: 5%"}),a(r(n),{field:"proc_id",header:"공정코드",pt:{columnHeaderContent:"justify-center"},headerStyle:"width: 7%"}),a(r(n),{field:"proc_name",header:"공정명",pt:{columnHeaderContent:"justify-center"},headerStyle:"width: 7%"}),a(r(n),{field:"total_inpt_qty",header:"실적상태",pt:{columnHeaderContent:"justify-center"},headerStyle:"width: 7%"})]),_:1},8,["value","selection"])],512)]),_:1})]),t("div",ie,[a(g,{title:"설비 선택",className:"shadow-sm w-3/5"},{"body-content":d(()=>[t("div",ce,[a(r(k),{dataKey:"equip_code",tableStyle:"max-width: 100%;",class:"fixed-data dense-table",showGridlines:"",scrollable:"",scrollHeight:"180px",editMode:"cell",size:"small",value:h.value,selection:p.value,"onUpdate:selection":e[3]||(e[3]=o=>p.value=o)},{empty:d(()=>[t("div",ue,x(v.value?"설비를 불러오는 중...":b.value||"지시 목록을 선택해주세요"),1)]),default:d(()=>[a(r(n),{selectionMode:"single",headerStyle:"width: 5%",field:"no",pt:{columnHeaderContent:"justify-center"}}),a(r(n),{field:"equip_code",header:"설비코드",pt:{columnHeaderContent:"justify-center"}}),a(r(n),{field:"equip_name",header:"설비명",pt:{columnHeaderContent:"justify-center"}}),a(r(n),{field:"comncode_dtnm",header:"설비상태",pt:{columnHeaderContent:"justify-center"}})]),_:1},8,["value","selection"])],512)]),_:1}),a(g,{title:"작업자 선택",className:"shadow-sm w-2/5"},{"body-content":d(()=>[t("div",pe,[a(r(k),{dataKey:"emp_id",tableStyle:"max-width: 100%;",class:"fixed-data dense-table",showGridlines:"",scrollable:"",scrollHeight:"180px",editMode:"cell",size:"small",value:q.value,selection:f.value,"onUpdate:selection":e[4]||(e[4]=o=>f.value=o)},{empty:d(()=>[...e[11]||(e[11]=[t("div",{class:"text-center"},"사원이 없습니다",-1)])]),default:d(()=>[a(r(n),{selectionMode:"single",headerStyle:"width: 5%",field:"no",pt:{columnHeaderContent:"justify-center"}}),a(r(n),{field:"emp_id",header:"사원번호",pt:{columnHeaderContent:"justify-center"}}),a(r(n),{field:"emp_name",header:"사원명",pt:{columnHeaderContent:"justify-center"}})]),_:1},8,["value","selection"])],512)]),_:1})])],32)])]),_:1}))}});export{Ce as default};
