import{p as ne,r as m,L as ie,k as ue,h as de,i as y,l as i,b as t,w as u,n as o,v,D as k,c as f,g as Y,t as G,F as H,j as J,J as W,u as c,s as pe,d as me,o as b}from"./index-CJ3q1JqJ.js";import{a as x}from"./index-ngrFHoWO.js";import{_ as ge}from"./AdminLayout-C24uwuk1.js";import{_ as ce}from"./common-BC0Yipj8.js";import{_ as T}from"./ComponentCardButton.vue_vue_type_script_setup_true_lang-BzeZFBPb.js";import{s as be,a as q}from"./index-BK6avQhT.js";import{C as Q}from"./component-CQdj2KLS.js";import{e as ye}from"./equipSelectModal-A_nYjCkt.js";/* empty css                   */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal.vue_vue_type_script_setup_true_lang-By9v9QUL.js";const ve={class:"flex gap-4"},fe={class:"w-1/4"},qe={class:"w-1/4"},xe={class:"w-1/4"},we=["value"],ke={class:"w-1/4"},Ce={class:"flex items-center gap-2"},he={class:"flex items-center gap-2"},_e={class:"flex gap-2 mt-2 w-full",style:{height:"550px"}},Se={class:"flex justify-end"},Ne=["disabled"],Ve={class:"w-full table-fixed border-collapse border border-gray-300"},Ue={class:"border border-gray-300 p-2"},Te=["disabled"],De={class:"border border-gray-300 p-2"},Ie={class:"border border-gray-300 p-2"},Fe={class:"relative"},je=["value"],Me={key:0,type:"button",class:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500",title:"유형 변경"},Re={class:"border border-gray-300 p-2"},Ee={class:"relative"},$e={class:"border border-gray-300 p-2"},Le={class:"border border-gray-300 p-2"},Be={class:"border border-gray-300 p-2"},Ae={class:"border border-gray-300 p-2"},Oe={class:"border border-gray-300 p-2"},ze={class:"border border-gray-300 p-2"},Ke={class:"border border-gray-300 p-2",colspan:"3"},p="dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-950 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",C="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400",Pe="focus:border-ring-brand-300 h-11 w-full overflow-hidden rounded-lg border border-gray-300 bg-transparent text-sm text-gray-500 shadow-theme-xs transition-colors file:mr-5 file:border-collapse file:cursor-pointer file:rounded-l-lg file:border-0 file:border-r file:border-solid file:border-gray-200 file:bg-gray-50 file:py-3 file:pl-3.5 file:pr-3 file:text-sm file:text-gray-700 placeholder:text-gray-400 hover:file:bg-gray-100 focus:outline-hidden focus:file:ring-brand-300 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-400 dark:text-white/90 dark:file:border-gray-800 dark:file:bg-white/[0.03] dark:file:text-gray-400 dark:placeholder:text-gray-400",st=ne({__name:"EquipMaster",setup(Ye){const X=m("설비 기준정보 관리"),D={dateFormat:"Y-m-d",altInput:!0,altFormat:"Y-m-d",wrap:!0},I=a=>({equipCode:a.equipCode??a.equip_code??"",equipName:a.equipName??a.equip_name??"",equipType:a.equipType??a.equip_type??"",equipTypeName:a.equipTypeName??a.equip_type_name??"",manager:a.manager??null,equipStatus:a.equipStatus??a.equip_status??"",equipStatusName:a.equipStatusName??a.equip_status_name??"",inspCycle:a.inspCycle??a.insp_cycle??null,installDate:a.installDate??a.install_date??null,modelName:a.modelName??a.model_name??null,equipImage:a.equipImage??a.equip_image??null,mfgDt:a.mfgDt??a.mfg_dt??null,maker:a.maker??null}),F=a=>{var e,l,n;return{equip_code:(e=a.equipCode)==null?void 0:e.trim(),equip_name:(l=a.equipName)==null?void 0:l.trim(),equip_type:(n=a.equipType)==null?void 0:n.trim(),manager:a.manager??null,equip_status:a.equipStatus||"j2",insp_cycle:a.inspCycle??null,install_date:a.installDate||null,model_name:a.modelName||null,equip_image:a.equipImage||null,mfg_dt:a.mfgDt||null,maker:a.maker||null}},j=()=>({equipCode:"",equipName:"",equipType:"",manager:"",equipStatus:"j2",inspCycle:0,installDate:"",modelName:"",equipImage:"",mfgDt:"",maker:""}),M=()=>({equipCode:"",equipName:"",equipType:"",equipStatus:""}),R=m({emp_name:""}),Z=a=>{R.value.emp_name=a.emp_name,s.value.manager=a.emp_name,E()},d=m(M()),h=ie([]),r=m(null),s=m(j()),_=m(!1),ee=()=>{_.value=!0},E=()=>{_.value=!1},S=m(null),$=m(0),L=m("선택된 파일 없음"),N=m(""),te=a=>{var n,g;const l=(n=a.target.files)==null?void 0:n[0];if(!l){B();return}if(L.value=l.name,(g=l.type)!=null&&g.startsWith("image/")){const U=new FileReader;U.onload=()=>{const P=U.result||"";N.value=P,s.value.equipImage=P},U.readAsDataURL(l)}else N.value="",s.value.equipImage=""},B=()=>{S.value&&(S.value.value=""),L.value="선택된 파일 없음",N.value="",s.value.equipImage="",$.value++},w=async()=>{try{const{data:a}=await x.get("/api/equipment",{params:d.value});h.value=(Array.isArray(a)?a:[]).map(I)}catch(a){console.error(a),h.value=[]}},V=m([]),ae=async()=>{try{const a=await x.get("/api/equipments");V.value=a.data}catch(a){console.error(a)}},A=async()=>{var a,e,l;if(!((a=s.value.equipCode)!=null&&a.trim())||!((e=s.value.equipName)!=null&&e.trim())||!((l=s.value.equipType)!=null&&l.trim())){alert("설비코드/설비명/설비유형은 필수입니다.");return}try{if(r.value){const n=r.value.equipCode||s.value.equipCode;await x.put(`/api/equipment/${encodeURIComponent(n)}`,F(s.value)),alert("수정 완료!")}else await x.post("/api/equipment",F(s.value)),alert("등록 완료!");await w()}catch(n){console.error(n),alert("저장 실패")}},O=async a=>{try{const{data:e}=await x.get(`/api/equipment/${encodeURIComponent(a)}`);return I(e)}catch(e){return console.error("상세 조회 실패:",e),null}},le=async()=>{var l,n;if(!r.value)return;const a=r.value.equipCode;if(confirm(`[${a}] 설비를 삭제할까요?`))try{await x.delete(`/api/equipment/${encodeURIComponent(a)}`),alert("삭제 완료"),r.value=null,z(),await w()}catch(g){console.error((g==null?void 0:g.response)??g),alert(((n=(l=g==null?void 0:g.response)==null?void 0:l.data)==null?void 0:n.message)??"삭제 실패")}},se=()=>Object.assign(d.value,M()),z=()=>{r.value=null,s.value=j(),R.value.emp_name="",B()},K=a=>{s.value={...a,inspCycle:a.inspCycle??0,equipStatus:a.equipStatus||"j2"}},oe=async a=>{r.value=a.data;const e=await O(a.data.equipCode);K(e??a.data)},re=async a=>{if(!a.value)return;r.value=a.value;const e=await O(a.value.equipCode);K(e??a.value)};return ue(async()=>{await ae(),await w()}),(a,e)=>(b(),de(ge,null,{default:y(()=>[i(ce,{pageTitle:X.value},null,8,["pageTitle"]),i(T,{title:"조회",className:"shadow-sm"},{"header-right":y(()=>[t("div",{class:"flex justify-end gap-2"},[t("button",{onClick:se,class:"btn-common btn-color"},"초기화"),t("button",{onClick:w,class:"btn-common btn-white"},"조회")])]),"body-content":y(()=>[t("div",ve,[t("div",fe,[t("label",{class:o(C)},"설비코드"),u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>d.value.equipCode=l),type:"text",class:o(p)},null,512),[[v,d.value.equipCode]])]),t("div",qe,[t("label",{class:o(C)},"설비명"),u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>d.value.equipName=l),type:"text",class:o(p)},null,512),[[v,d.value.equipName]])]),t("div",xe,[t("label",{class:o(C)},"설비유형"),u(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>d.value.equipType=l),class:o(p)},[e[17]||(e[17]=t("option",{value:""},"설비유형 선택",-1)),(b(!0),f(H,null,Y(V.value,(l,n)=>(b(),f("option",{key:n,value:l.code},G(l.name),9,we))),128))],512),[[k,d.value.equipType]])]),t("div",ke,[t("div",{class:o(C)},"설비상태"),t("label",Ce,[u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>d.value.equipStatus=l),type:"radio",name:"equip-using",value:"j1"},null,512),[[W,d.value.equipStatus]]),e[18]||(e[18]=J(" 가동중 ",-1))]),t("label",he,[u(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>d.value.equipStatus=l),type:"radio",name:"equip-using",value:"j2"},null,512),[[W,d.value.equipStatus]]),e[19]||(e[19]=J(" 비가동 ",-1))])])])]),_:1}),t("div",_e,[i(T,{title:"목록",class:"shadow-sm w-1/2"},{"header-right":y(()=>[t("div",Se,[t("button",{class:"btn-common btn-color",disabled:!r.value,onClick:le}," 삭제 ",8,Ne)])]),"body-content":y(()=>[i(c(be),{value:h.value,showGridlines:"",selection:r.value,"onUpdate:selection":e[5]||(e[5]=l=>r.value=l),dataKey:"equipCode",scrollable:"",scrollHeight:"390px",class:"text-sm",rows:20,size:"small",onRowClick:oe,onSelectionChange:re},{default:y(()=>[i(c(q),{selectionMode:"single",headerStyle:"width: 2.5rem"}),i(c(q),{field:"equipCode",header:"설비코드"}),i(c(q),{field:"equipName",header:"설비명"}),i(c(q),{field:"equipTypeName",header:"설비유형",sortable:""}),i(c(q),{field:"manager",header:"담당자",sortable:""}),i(c(q),{field:"equipStatusName",header:"설비상태",sortable:""}),i(c(q),{field:"inspCycle",header:"점검주기",sortable:"",style:{width:"110px","text-align":"center"}})]),_:1},8,["value","selection"])]),_:1}),i(T,{title:"등록/수정",class:"shadow-sm w-1/2"},{"header-right":y(()=>[t("div",{class:"flex justify-end gap-2"},[t("button",{onClick:A,class:"btn-common btn-color"},"저장"),t("button",{onClick:z,class:"btn-common btn-white"},"신규")])]),"body-content":y(()=>[t("form",{onSubmit:pe(A,["prevent"])},[t("table",Ve,[e[35]||(e[35]=t("colgroup",null,[t("col",{style:{width:"120px"}}),t("col"),t("col",{style:{width:"120px"}}),t("col")],-1)),t("tbody",null,[t("tr",null,[e[20]||(e[20]=t("th",{class:"border border-gray-300 bg-gray-50 text-sm text-center p-2"}," 설비코드 ",-1)),t("td",Ue,[u(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.equipCode=l),disabled:!!r.value,type:"text",class:o(p)},null,8,Te),[[v,s.value.equipCode]])]),e[21]||(e[21]=t("th",{class:"border border-gray-300 bg-gray-50 text-sm text-center p-2"},"설비명",-1)),t("td",De,[u(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.equipName=l),type:"text",class:o(p)},null,512),[[v,s.value.equipName]])])]),t("tr",null,[e[24]||(e[24]=t("th",{class:"border border-gray-300 bg-gray-50 text-sm text-center p-2"}," 설비유형 ",-1)),t("td",Ie,[t("div",Fe,[u(t("select",{"onUpdate:modelValue":e[8]||(e[8]=l=>s.value.equipType=l),class:o(p)},[e[22]||(e[22]=t("option",{value:""},"설비유형 선택",-1)),(b(!0),f(H,null,Y(V.value,(l,n)=>(b(),f("option",{key:n,value:l.code},G(l.name),9,je))),128))],512),[[k,s.value.equipType]]),r.value?(b(),f("button",Me)):me("",!0)])]),e[25]||(e[25]=t("th",{class:"border border-gray-300 bg-gray-50 text-sm text-center p-2"},"담당자",-1)),t("td",Re,[t("div",Ee,[u(t("input",{type:"text",placeholder:"담당자를 선택해주세요","onUpdate:modelValue":e[9]||(e[9]=l=>s.value.manager=l),readonly:"",class:o(p)},null,512),[[v,s.value.manager]]),t("button",{type:"button",class:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500",onClick:ee,title:"담당자 찾기"},[...e[23]||(e[23]=[t("span",{class:"pi pi-search"},null,-1)])])])])]),t("tr",null,[e[26]||(e[26]=t("th",{class:"border border-gray-300 bg-gray-50 text-sm text-center p-2"},"제조사",-1)),t("td",$e,[u(t("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>s.value.maker=l),type:"text",class:o(p)},null,512),[[v,s.value.maker]])]),e[27]||(e[27]=t("th",{class:"border border-gray-300 bg-gray-50 text-sm text-center p-2"}," 설치일자 ",-1)),t("td",Le,[i(c(Q),{modelValue:s.value.installDate,"onUpdate:modelValue":e[11]||(e[11]=l=>s.value.installDate=l),disabled:!!r.value,config:D,class:"dark:bg-dark-900 h-11 w-full rounded-lg border px-4 py-2.5"},null,8,["modelValue","disabled"])])]),t("tr",null,[e[28]||(e[28]=t("th",{class:"border border-gray-300 bg-gray-50 text-sm text-center p-2"},"모델명",-1)),t("td",Be,[u(t("input",{"onUpdate:modelValue":e[12]||(e[12]=l=>s.value.modelName=l),type:"text",class:o(p)},null,512),[[v,s.value.modelName]])]),e[29]||(e[29]=t("th",{class:"border border-gray-300 bg-gray-50 text-sm text-center p-2"}," 설비이미지 ",-1)),t("td",Ae,[(b(),f("input",{key:$.value,ref_key:"fileInputEl",ref:S,onChange:te,type:"file",class:o(Pe),id:"inspFile"},null,32))])]),t("tr",null,[e[30]||(e[30]=t("th",{class:"border border-gray-300 bg-gray-50 text-sm text-center p-2"}," 제조일자 ",-1)),t("td",Oe,[i(c(Q),{modelValue:s.value.mfgDt,"onUpdate:modelValue":e[13]||(e[13]=l=>s.value.mfgDt=l),disabled:!!r.value,config:D,class:"dark:bg-dark-900 h-11 w-full rounded-lg border px-4 py-2.5"},null,8,["modelValue","disabled"])]),e[31]||(e[31]=t("th",{class:"border border-gray-300 bg-gray-50 text-sm text-center p-2"}," 점검주기(일) ",-1)),t("td",ze,[u(t("input",{"onUpdate:modelValue":e[14]||(e[14]=l=>s.value.inspCycle=l),type:"number",class:o(p),placeholder:"예: 30"},null,512),[[v,s.value.inspCycle,void 0,{number:!0}]])])]),t("tr",null,[e[34]||(e[34]=t("th",{class:"border border-gray-300 bg-gray-50 text-sm text-center p-2"}," 설비상태 ",-1)),t("td",Ke,[r.value?u((b(),f("select",{key:1,"onUpdate:modelValue":e[16]||(e[16]=l=>s.value.equipStatus=l),class:o(p)},[...e[33]||(e[33]=[t("option",{value:"j1"},"가동중",-1),t("option",{value:"j2"},"비가동",-1)])],512)),[[k,s.value.equipStatus]]):u((b(),f("select",{key:0,"onUpdate:modelValue":e[15]||(e[15]=l=>s.value.equipStatus=l),class:o(p),disabled:""},[...e[32]||(e[32]=[t("option",{value:"j2"},"비가동",-1)])],512)),[[k,s.value.equipStatus]])])])])])],32),i(ye,{onSelectedEmpValue:Z,visible:_.value,onClose:E},null,8,["visible"])]),_:1})])]),_:1}))}});export{st as default};
