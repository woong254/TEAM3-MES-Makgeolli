import{p as $,I as B,r as u,G as F,q as z,k as A,E as H,h as Y,i as S,l as p,b as t,s as j,w as m,v as w,n as d,D as G,u as V,c as I,t as E,F as O,o as _}from"./index-CJ3q1JqJ.js";import{a as c}from"./index-ngrFHoWO.js";import{_ as P}from"./AdminLayout-C24uwuk1.js";import{_ as J}from"./common-BC0Yipj8.js";import{_ as K}from"./ComponentCardButton.vue_vue_type_script_setup_true_lang-BzeZFBPb.js";import{C as T}from"./component-CQdj2KLS.js";import{e as L}from"./equipSelectModal-A_nYjCkt.js";/* empty css                   */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal.vue_vue_type_script_setup_true_lang-By9v9QUL.js";import"./index-BK6avQhT.js";const Q={class:"flex gap-2 mt-2 w-full"},W={class:"w-full table-fixed border-collapse border border-gray-200"},X={class:"border border-gray-200 p-2"},Z=["disabled"],ee={class:"border border-gray-200 p-2"},te=["disabled"],oe={class:"border border-gray-200 p-2"},re=["disabled"],ae={class:"border border-gray-200 p-2"},se={class:"relative"},ne=["disabled"],le={colspan:"3",class:"border border-gray-200 p-2"},de=["disabled"],ie={class:"border border-gray-200 p-2"},ue={class:"border border-gray-200 p-2"},pe={class:"mt-6 w-full flex items-center justify-center"},me=["disabled"],ce=["disabled"],i="dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-950 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",Se=$({__name:"DowntimeManage",setup(be){const y=F(),U=H(),o=B({equipCode:"",equipName:"",workerId:"",downtimeType:"비계획정지",description:"",progressStatus:"진행중",downtimeStart:"",downtimeEnd:null}),M=a=>{o.workerId=a.emp_name,C()},N=u("비가동 등록"),x={enableTime:!0,time_24hr:!0,dateFormat:"Y-m-d H:i",altInput:!0,altFormat:"Y-m-d H:i"};u(y.query.mode||"register");const n=u(null),s=u(!1),b=u(!1),q=z(()=>n.value!==null),l=()=>!!n.value,g=u(!1),D=()=>{g.value=!0},C=()=>{g.value=!1};async function f(a){const{data:e}=await c.get(`/api/downtime/${encodeURIComponent(a)}`);n.value=e.downtimeCode??e.downtime_code,o.equipCode=e.equipCode??e.equip_code,o.equipName=e.equipName??e.equip_name,o.downtimeType=e.downtimeType??e.downtime_type,o.workerId=e.workerId??e.worker_id??"",o.description=e.description??"",o.downtimeStart=e.downtimeStart??e.downtime_start,o.downtimeEnd=e.downtimeEnd??e.downtime_end??null,o.progressStatus=e.progressStatus??e.progress_status??"진행중"}async function h(a){const{data:e}=await c.get(`/api/equipment/${encodeURIComponent(a)}`);o.equipCode=e.equip_code,o.equipName=e.equip_name;const{data:r}=await c.get("/api/downtime",{params:{status:"running",equip_code:a}});Array.isArray(r)&&r.length>0?await f(r[0].downtimeCode??r[0].downtime_code):(n.value=null,o.progressStatus="진행중",o.downtimeEnd=null)}async function k(){var a,e;if(!o.equipCode.trim())return alert("설비코드를 확인하세요.");if(!o.workerId.trim())return alert("담당자를 입력/선택하세요.");if(!(q.value||s.value))try{s.value=!0;const r={equip_code:o.equipCode.trim(),equip_name:o.equipName.trim()||null,worker_id:o.workerId.trim(),downtime_type:o.downtimeType||"비계획정지",description:o.description.trim()||null,progress_status:"진행중",downtime_start:o.downtimeStart.trim()||void 0},{data:v}=await c.post("/api/downtime",r);n.value=(v==null?void 0:v.downtime_code)||null,alert("비가동이 시작되었습니다."),n.value&&await f(n.value)}catch(r){console.error(r),alert(((e=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:e.message)||"비가동 시작 중 오류가 발생했습니다.")}finally{s.value=!1}}async function R(){var a,e;if(n.value&&confirm("비가동을 종료하시겠습니까?"))try{b.value=!0,await c.put(`/api/downtime/${encodeURIComponent(n.value)}/end`,{progress_status:"완료"}),alert("비가동이 종료되었습니다."),await h(o.equipCode)}catch(r){console.error(r),alert(((e=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:e.message)||"종료 처리 중 오류가 발생했습니다.")}finally{b.value=!1}}return A(async()=>{const a=y.query.downtimeCode;if(a)try{await f(a);return}catch(r){console.error(r),alert("상세 정보를 불러오지 못했습니다.")}const e=y.query.equipCode;if(!e){alert("선택된 설비가 없습니다."),U.push("/downtimelist");return}try{await h(e)}catch(r){console.error(r),alert("정보를 불러오는 중 오류가 발생했습니다.")}}),(a,e)=>(_(),Y(P,null,{default:S(()=>[p(J,{pageTitle:N.value},null,8,["pageTitle"]),t("div",Q,[p(K,{title:"비가동 등록"},{"body-content":S(()=>[t("form",{onSubmit:j(k,["prevent"])},[t("table",W,[e[16]||(e[16]=t("colgroup",null,[t("col",{style:{width:"120px"}}),t("col"),t("col",{style:{width:"120px"}}),t("col")],-1)),t("tbody",null,[t("tr",null,[e[7]||(e[7]=t("th",{class:"border border-gray-200 bg-gray-50 text-sm text-center p-2"}," 설비코드 ",-1)),t("td",X,[m(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.equipCode=r),readonly:"",disabled:l()||s.value,type:"text",class:d(i),placeholder:"설비코드를 입력해주세요"},null,8,Z),[[w,o.equipCode]])]),e[8]||(e[8]=t("th",{class:"border border-gray-200 bg-gray-50 text-sm text-center p-2"},"설비명",-1)),t("td",ee,[m(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.equipName=r),readonly:"",disabled:l()||s.value,type:"text",class:d(i),placeholder:"설비명을 입력해주세요"},null,8,te),[[w,o.equipName]])])]),t("tr",null,[e[11]||(e[11]=t("th",{class:"border border-gray-200 bg-gray-50 text-sm text-center p-2"}," 비가동유형 ",-1)),t("td",oe,[m(t("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.downtimeType=r),class:d(i),disabled:l()||s.value},[...e[9]||(e[9]=[t("option",{value:"비계획정지"},"비계획정지",-1),t("option",{value:"계획정지"},"계획정지",-1),t("option",{value:"점검/수리"},"점검/수리",-1)])],8,re),[[G,o.downtimeType]])]),e[12]||(e[12]=t("th",{class:"border border-gray-200 bg-gray-50 text-sm text-center p-2"},"담당자",-1)),t("td",ae,[t("div",se,[m(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.workerId=r),disabled:l()||s.value,type:"text",class:d(i)},null,8,ne),[[w,o.workerId]]),t("button",{type:"button",class:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500",onClick:D,title:"담당자 찾기"},[...e[10]||(e[10]=[t("span",{class:"pi pi-search"},null,-1)])])])])]),t("tr",null,[e[13]||(e[13]=t("th",{class:"border border-gray-200 bg-gray-50 text-sm text-center p-2"},"비고",-1)),t("td",le,[m(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.description=r),class:d([i,"w-full resize-none rounded-lg border p-2"]),rows:"4",placeholder:"비고를 입력하세요",style:{height:"120px"},disabled:l()},null,8,de),[[w,o.description]])])]),t("tr",null,[e[14]||(e[14]=t("th",{class:"border border-gray-200 bg-gray-50 text-sm text-center p-2"}," 비가동 시작일시 ",-1)),t("td",ie,[p(V(T),{modelValue:o.downtimeStart,"onUpdate:modelValue":e[5]||(e[5]=r=>o.downtimeStart=r),config:x,class:d(i),disabled:l()||s.value,placeholder:"미입력 시 현재시간으로 저장"},null,8,["modelValue","disabled"])]),e[15]||(e[15]=t("th",{class:"border border-gray-200 bg-gray-50 text-sm text-center p-2"}," 비가동 종료일시 ",-1)),t("td",ue,[p(V(T),{modelValue:o.downtimeEnd,"onUpdate:modelValue":e[6]||(e[6]=r=>o.downtimeEnd=r),config:x,class:d(i),disabled:!0,placeholder:"종료 화면에서 설정"},null,8,["modelValue"])])])])])],32),t("div",pe,[q.value?(_(),I(O,{key:1},[e[17]||(e[17]=t("button",{class:"btn-common btn-white cursor-not-allowed opacity-70 w-36 h-12 text-base font-semibold",disabled:""}," 진행중 ",-1)),t("button",{class:"btn-common btn-color disabled:opacity-50 w-48 h-12 text-base font-semibold",disabled:b.value,onClick:R},E(b.value?"종료 중...":"비가동 종료"),9,ce)],64)):(_(),I("button",{key:0,onClick:k,class:"btn-common btn-color disabled:opacity-50 w-48 h-12 text-base font-semibold whitespace-nowrap",disabled:s.value||!o.equipCode||l()},E(s.value?"시작 중...":l()?"진행중":"비가동 시작"),9,me))]),p(L,{onSelectedEmpValue:M,visible:g.value,onClose:C},null,8,["visible"])]),_:1})])]),_:1}))}});export{Se as default};
