import{p as I,G as D,r as m,k as N,H as T,h as j,i as _,l as y,b as e,n as s,w as c,v as d,o as B}from"./index-CJ3q1JqJ.js";import{_ as F}from"./AdminLayout-C24uwuk1.js";import{_ as Q}from"./common-BC0Yipj8.js";import{_ as x}from"./ComponentCardOrder.vue_vue_type_script_setup_true_lang-BMJk9k7N.js";import{a as g}from"./index-ngrFHoWO.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $={class:"space-y-5 sm:space-y-3 mt-2"},z={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},E=["value"],M=["value"],G=["value"],H=["value"],O=["value"],A={class:"flex gap-2 mt-2 width-full"},J={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-4 mr-10 mt-3"},K={class:"flex items-center"},L=["value"],W={class:"flex items-center"},X={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-4 mr-10"},Y={class:"flex items-center"},Z={class:"flex items-center"},ee={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-4 mr-10"},te={class:"flex items-center"},se={class:"flex items-center"},le={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-4 mr-10"},ae={class:"flex items-center"},re={class:"flex flex-col justify-center h-full space-y-4 px-4 bg-white mr-10"},oe={class:"flex items-center space-x-2 mt-15"},ne={class:"flex items-center space-x-2"},o="font-bold dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-lg text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",n="font-bold block text-lg text-gray-700 dark:text-gray-400 mb-2",ie=I({__name:"ProcessControl",setup(ce){const v=D(),q=v.query.emp_id,h=v.query.equip_code,w=v.query.mkd_no;console.log("넘어온 사원번호:",q);const k=m("공정제어"),l=m({procs_no:0,mk_num:0,prod_name:"",writing_date:"",equip_name:"",proc_name:"",emp_name:"",inpt_qty:0,prev_input_qty:0,remain_qty:0}),p=m({procs_bgntm:""}),a=m({procs_endtm:"",procs_no:0,mk_qty:0,fail_qty:0,pass_qty:0});let u=null;const f=async()=>{if(l.value.procs_no!==0)try{const t=(await g.get("/api/getCurrentProcessQty",{params:{procs_no:l.value.procs_no}})).data.result;t&&(a.value.mk_qty=t.mk_qty??0,t.procs_st==="t3"?(b(),a.value.procs_endtm=t.procs_endtm||"완료",a.value.fail_qty=t.fail_qty??0,a.value.pass_qty=t.pass_qty??0,p.value.procs_bgntm=t.procs_bgntm||"작업 시작",alert("작업이 완료 상태로 변경되었습니다.")):t.procs_st==="t2"&&t.procs_bgntm&&(p.value.procs_bgntm=t.procs_bgntm))}catch(i){console.error("fetchCurrentQty 오류:",i)}},P=()=>{u||(f(),u=setInterval(f,1e3),console.log("Polling started."))},b=()=>{u!==null&&(clearInterval(u),u=null,console.log("Polling stopped."))},C=async i=>{i!==0&&await f()},V=async()=>{try{const t=(await g.get("/api/getProcessData",{params:{emp_id:q,equip_code:h,mkd_no:w}})).data.result[0];console.log("dbResult:",t),l.value.procs_no=t.procs_no,l.value.prod_name=t.prod_name,l.value.writing_date=t.writing_date,l.value.equip_name=t.equip_name,l.value.proc_name=t.now_procs,l.value.emp_name=t.emp_name,l.value.mk_num=t.mk_num,l.value.inpt_qty=t.inpt_qty,l.value.prev_input_qty=t.prev_input_qty,l.value.remain_qty=t.remain_qty,await C(t.procs_no)}catch(i){console.error("fetchProcessData에서 오류가 생겼습니다. 오류내용 : ",i)}},U=async()=>{if(a.value.mk_qty===l.value.inpt_qty){alert("이미 작업이 종료되었습니다.");return}const i={procs_no:l.value.procs_no};try{const t=await g.post("/api/processStart",i);if(console.log("작업시작 버튼 누르고 받은 데이터 response : ",t),t.data.isSuccessed)alert("작업시작성공"),p.value.procs_bgntm=t.data.result.procs_bgntm,P();else{alert("작업시작실패");return}}catch(t){console.error("processStart 오류 : ",t)}},S=async()=>{if(a.value.mk_qty===0){alert("작업이 시작되지 않았습니다.");return}if(a.value.procs_endtm){alert("이미 작업이 종료되었습니다.");return}const i={procs_no:l.value.procs_no};try{const t=await g.post("/api/modifyProcessForm",i);if(console.log("modifyProcessForm:",t),t.data.isSuccessed)alert("작업종료성공"),a.value=t.data.result,b();else{alert("작업종료실패");return}}catch(t){console.error("processEnd오류 : ",t)}};return N(()=>{V()}),T(()=>{b()}),(i,t)=>(B(),j(F,null,{default:_(()=>[y(Q,{pageTitle:k.value},null,8,["pageTitle"]),e("div",$,[y(x,{title:"지시내용"},{"body-content":_(()=>[e("div",z,[e("div",null,[e("label",{class:s(n)}," 제품명 "),e("input",{type:"text",class:s(o),required:"",readonly:"",value:l.value.prod_name},null,8,E)]),e("div",null,[e("label",{class:s(n)}," 공정명 "),e("input",{type:"text",class:s(o),required:"",readonly:"",value:l.value.proc_name},null,8,M)]),e("div",null,[e("label",{class:s(n)}," 설비명 "),e("input",{type:"text",class:s(o),required:"",readonly:"",value:l.value.equip_name},null,8,G)]),e("div",null,[e("label",{class:s(n)}," 작업자명 "),e("input",{type:"text",class:s(o),required:"",readonly:"",value:l.value.emp_name},null,8,H)]),e("div",null,[e("label",{class:s(n)}," 작업지시일 "),e("input",{type:"text",class:s(o),required:"",readonly:"",value:l.value.writing_date,style:{"text-align":"center"}},null,8,O)])])]),_:1}),e("div",A,[y(x,{title:"작업량",className:"shadow-sm w-3/5 h-80"},{"body-content":_(()=>[e("div",J,[e("div",K,[e("label",{class:s([n,"mr-2 whitespace-nowrap ml-10 mr-14"])},"지시량"),e("input",{type:"text",class:s(o),required:"",readonly:"",value:l.value.mk_num,style:{"text-align":"right"}},null,8,L)]),e("div",W,[e("label",{class:s([n,"mr-2 whitespace-nowrap ml-10 mr-10"])},"생산량"),c(e("input",{type:"text",class:s(o),required:"",readonly:"","onUpdate:modelValue":t[0]||(t[0]=r=>a.value.mk_qty=r),style:{"text-align":"right","background-color":"#e6ffe6",color:"#228b22"}},null,512),[[d,a.value.mk_qty]])])]),e("div",X,[e("div",Y,[e("label",{class:s([n,"mr-2 whitespace-nowrap ml-10 mr-10"])},"기투입량"),c(e("input",{type:"text",class:s(o),required:"",readonly:"","onUpdate:modelValue":t[1]||(t[1]=r=>l.value.prev_input_qty=r),style:{"text-align":"right"}},null,512),[[d,l.value.prev_input_qty]])]),e("div",Z,[e("label",{class:s([n,"mr-2 whitespace-nowrap ml-10 mr-10"])},"불량량"),c(e("input",{type:"text",class:s(o),required:"",readonly:"","onUpdate:modelValue":t[2]||(t[2]=r=>a.value.fail_qty=r),style:{"text-align":"right"}},null,512),[[d,a.value.fail_qty]])])]),e("div",ee,[e("div",te,[e("label",{class:s([n,"mr-2 whitespace-nowrap ml-10 mr-10"])},"미투입량"),c(e("input",{type:"text",class:s(o),required:"",readonly:"","onUpdate:modelValue":t[3]||(t[3]=r=>l.value.remain_qty=r),style:{"text-align":"right"}},null,512),[[d,l.value.remain_qty]])]),e("div",se,[e("label",{class:s([n,"mr-2 whitespace-nowrap ml-10 mr-10"])},"합격량"),c(e("input",{type:"text",class:s(o),required:"",readonly:"","onUpdate:modelValue":t[4]||(t[4]=r=>a.value.pass_qty=r),style:{"text-align":"right"}},null,512),[[d,a.value.pass_qty]])])]),e("div",le,[e("div",ae,[e("label",{class:s([n,"mr-2 whitespace-nowrap ml-10 mr-10"])},"현투입량"),c(e("input",{type:"text",class:s(o),required:"",readonly:"","onUpdate:modelValue":t[5]||(t[5]=r=>l.value.inpt_qty=r),style:{"text-align":"right"}},null,512),[[d,l.value.inpt_qty]])])])]),_:1}),y(x,{title:"작업날짜",className:"shadow-sm w-2/5 h-80"},{"body-content":_(()=>[e("div",re,[e("div",oe,[e("label",{class:s([n,"mr-2 whitespace-nowrap ml-10 mr-10"])},"작업시작일"),c(e("input",{type:"text",class:s(o),required:"",readonly:"","onUpdate:modelValue":t[6]||(t[6]=r=>p.value.procs_bgntm=r),style:{"text-align":"center"}},null,512),[[d,p.value.procs_bgntm]])]),e("div",ne,[e("label",{class:s([n,"mr-2 whitespace-nowrap ml-10 mr-10"])},"작업종료일"),c(e("input",{type:"text",class:s(o),required:"",readonly:"","onUpdate:modelValue":t[7]||(t[7]=r=>a.value.procs_endtm=r),style:{"text-align":"center"}},null,512),[[d,a.value.procs_endtm]])])])]),_:1})]),e("div",{style:{"text-align":"center","font-size":"25px","font-weight":"bold"},class:"mt-5"},[e("button",{type:"button",class:"btn-reset btn-common btn-white",style:{"margin-right":"10px"},onClick:U}," 작업시작 "),e("button",{type:"button",class:"btn-reset btn-common btn-color",style:{"margin-left":"10px"},onClick:S}," 작업종료 ")])])]),_:1}))}}),ge=R(ie,[["__scopeId","data-v-a6ac7248"]]);export{ge as default};
